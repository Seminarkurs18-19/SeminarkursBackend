<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Abfragen</title>
    <link href="stylesheets/stylesheet.css" type="text/css" rel="stylesheet">
    <script src="js/socket.js"></script>
</head>
<body>

<h1>Testabfrage</h1>
<p>Benutzerdefinierte Abfrage an die Datenbank mit Datenausgabe</p>
<h2>Anfragen an eine Tabelle</h2>

<form>
    Tabelle:
    <select id="tabelle">
        <option value="Indi_Artikel">Individueller Artikel(Item)</option>
        <option value="Artikel">Artikel</option>
        <option value="Kommentar">Kommentar</option>
    </select><br><br>
    SessionID:<input type="text" id="session_id"><br><br>
    <button onclick="verarbeitung()" id="verarbeitung">Suchen</button>
</form>
<br>
<div id="ausgabe"></div>

<a href="index.html">Zurück</a>
<script>
    //Verbindung herstellen
    var connection = io();
    var data = {};

    var txt_session = document.getElementById("session_id");

    /*****************Tabellen bekommen*******************/
    connection.on('get_table', (table) => {
        document.getElementById('ausgabe').innerHTML = "";
        console.log(table);
        table.forEach((e, i) => {
            console.log("Back: " + e);
            document.getElementById('ausgabe').innerHTML += "<p>" + e.ITEM_ID + ": " + e.ARTIKEL_ID + "</p>";
        })
    });

    //Daten EMIT (Schicken)spalte
    /*****************Tabellen abschicken*******************/

    document.getElementById('verarbeitung').onclick = function (e) {

        //Daten GET (Bekommen)
        e.preventDefault();
        console.log("klick");
        //Abfragen des DropDown
        var tabelle = document.getElementById('tabelle').value;
        if (tabelle === "Artikel") table = "Artikel";
        else if (tabelle === "Indi_Artikel") table = "Item_from_Artikel";
        else if (tabelle === "Kommentar") table = "Comment_on_Item";

        Sitzungs_ID = txt_session.value;
        data = {table, Sitzungs_ID};
        console.log(data);
        //Abschicken der Tabelle
        connection.emit('ask_table', data);
    };
</script>
</body>
</html>
