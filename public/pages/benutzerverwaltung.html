<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Benutzerverwaltung</title>
    <link href="../stylesheets/stylesheet.css" rel="stylesheet">
    <link href="../images/icon.png" rel="icon" sizes="16x16">
    <script src="../js/socket.js"></script>
</head>
<body id="bdy" onload="start()" style="visibility: hidden">
<div class="divLeft">
    <ul>
        <li><img class="imgLogo" src="../images/logo_boysen.png"></li>
        <li id="liStartseite"><a href="startseite.html">Startseite</a></li>
        <li id="liBenutzerverwaltung"><a href="benutzerverwaltung.html">Benutzerverwaltung</a></li>
        <li id="liDatenbankverwaltung"><a href="datenbankverwaltung.html">Datenbankverwaltung</a></li>
        <li id="liSupportverwaltung"><a href="supporterverwaltung.html">Supporterverwaltung</a></li>
    </ul>
</div>
<div class="divBody">
    <div class="divTitle">
        <h1>Benutzerverwaltung</h1>
    </div>
    <div class="divContent">
        <!-------------------------------------------------------Variabler Content------------------------------------------------------------------>
        <div class="dropdown">
            <button class="dropbtn" onclick="myFunction()"><b>Auswahl:</b></button>
            <div class="dropdown-content" id="myDropdown">
                <input id="myInput" onkeyup="filterFunction()" placeholder="Suche..." type="text">
                <a onclick="optRegistration()">Benutzer registrieren</a>
                <a onclick="optChangeUsername()">Benutzername ändern</a>
                <a onclick="optChangePassword()">Passwort ändern</a>
                <a onclick="optChangeDepartment()">Abteilung ändern</a>
                <a onclick="optDeleteUser()">Benutzer löschen</a>
            </div>
        </div>
        <div class="divCenter">
            <div class="divOption" id="divOption">

            </div>
        </div>
        <!---------------------------------------------------Ende variabler Content----------------------------------------------------------------->
    </div>
</div>
<div class="divRight">
    <div class="divBenutzer">
        <img class="icon_pers" src="../images/icon_pers.png">

    </div>
    <div class="divUserData">
        <p id="pUserData">
        </p>
        <p>
            <a href="login/login.html" onclick="reset()">abmelden</a>
        </p>
    </div>
</div>
</body>
<script>
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////Notwendiger Code jeder Seite ///////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    var connection = io();

    var pUserData = document.getElementById("pUserData"),
        body = document.getElementById('bdy');

    function start() {
        var session_id = sessionStorage.getItem("session");
        var data = {session_id};
        connection.emit('user.check.session', data);
    }

    function reset() {
        sessionStorage.clear();
    }

    connection.on('user.check.session.result', (data) => {
        if (data.result === true) {
            console.log("SessionID: Berechtigt");
            body.style.visibility = 'visible';
            var session_id = sessionStorage.getItem('session');
            connection.emit('session.user.get', {session_id});
        } else {
            window.location.href = '../index.html';
        }
    });
    connection.on('session.user.get.result', (data) => {
        var Rollen_Nr = String(data.Rollen_Nr);
        if (Rollen_Nr === "3" || Rollen_Nr === "4") {
            console.log("Hallo" + Rollen_Nr);
            document.getElementById("liSupportverwaltung").style.visibility = "hidden";
            document.getElementById("liDatenbankverwaltung").style.visibility = "hidden";
        }
        var bnNr = String(data.result[0]['Benutzer_Nr']),
            bnResult;
        switch (bnNr.length) {
            case 1:
                bnResult = "000" + bnNr;
                break;
            case 2:
                bnResult = "00" + bnNr;
                break;
            case 3:
                bnResult = "0" + bnNr;
                break;
            default:
                bnResult = bnNr;
        }
        pUserData.innerHTML = "<b style='font-size: large'>" + data.result[0]['Benutzername'] + "</b>" +
            "<a style='color: gray; font-size: smaller'>#" + bnResult +
            "</a><br>" + data.result[0]['Rollen_Name'] + " / " + data.result[0]['Abteilung'];
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////Ende des notwendigen Codes///////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    });

    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    function filterFunction() {
        var input, filter, ul, li, a, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        div = document.getElementById("myDropdown");
        a = div.getElementsByTagName("a");
        for (i = 0; i < a.length; i++) {
            txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                a[i].style.display = "";
            } else {
                a[i].style.display = "none";
            }
        }
    }
</script>
<script>
    var divOption = document.getElementById('divOption');

    //////////////////////////////////////////////////////Benutzerverwaltung/////////////////////////////////////////////////////////
    function optRegistration() {
        divOption.innerHTML = " ";
        divOption.innerHTML =
            "<div>" +
            "<h1>Benutzer-Registration</h1>" +
            "<input id='iptBenutzername' placeholder='Benutzername' type='text'><br>" +
            "<input id='iptPasswort' placeholder='Passwort' type='text'><br>" +
            "<button id='btnLogin' onclick='registration()'>Registrieren</button>" +
            "<br>" +
            "<div id='divResult'>" +
            "</div>"

    }

    function optChangeUsername() {
        divOption.innerHTML = "";
        divOption.innerHTML =
            '<div>' +
            '<div id="divLogin" style="margin: 0px auto; top: 0; left:0;">' +
            '<h1>Benutzerdaten</h1>' +
            '<input id="iptBenutzername" placeholder="Benutzername" type="text"><br>' +
            '<input id="iptPasswort" placeholder="Passwort" type="text"><br>' +
            '</div><div style="margin: 0px auto">' +
            '<h1>Neuer Benutzername</h1>' +
            '<input id="iptNewUsername" placeholder="neuer Benutzername" type="text">' +
            '<button id="btnNewUsername" onclick="changeUsername()">Senden</button>' +
            '</div>' +
            '<br>' +
            '<div id="divResult">' +
            '</div>' +
            '</div>'

    }

    function optChangePassword() {
        divOption.innerHTML = "";
        divOption.innerHTML =
            '<div>' +
            '<div id="divLogin" style="margin: 0px auto; top: 0; left:0;">' +
            '<h1>Benutzerdaten</h1>' +
            '<input id="iptBenutzername" placeholder="Benutzername" type="text"><br>' +
            '<input id="iptPasswort" placeholder="Passwort" type="text"><br>' +
            '</div><div style="margin: 0px auto">' +
            '<h1>Neues Passwort</h1>' +
            '<input id="iptNewPassword" placeholder="neues Passwort" type="text">' +
            '<button id="btnNewPassword" onclick="changePassword()">Senden</button>' +
            '</div>' +
            '<br>' +
            '<div id="divResult">' +
            '</div>' +
            '</div>'

    }

    function optChangeDepartment() {
        divOption.innerHTML = "";
        divOption.innerHTML =
            '<div>' +
            '<div id="divLogin" style="margin: 0px auto; top: 0; left:0;">' +
            '<h1>Benutzerdaten</h1>' +
            '<input id="iptBenutzername" placeholder="Benutzername" type="text"><br>' +
            '<input id="iptPasswort" placeholder="Passwort" type="text"><br>' +
            '</div><div style="margin: 0px auto">' +
            '<h1>Neue Abteilung</h1>' +
            '<input id="iptNewDepartment" placeholder="neue Abteilung" type="text">' +
            '<button id="btnNewDepartment" onclick="changeDepartment()">Senden</button>' +
            '</div>' +
            '<br>' +
            '<div id="divResult">' +
            '</div>' +
            '</div>'
    }

    function optDeleteUser() {
        divOption.innerHTML = "";
        divOption.innerHTML =
            '<div style="margin: 0px auto">' +
            '<h1>Benutzername des Benutzers</h1>' +
            '<input id="iptUsername" placeholder="Benutzername" type="text">' +
            '<button id="btnUsername" onclick="deleteUser()">Löschen</button>' +
            '</div>' +
            '<br>' +
            '<div id="divResult">' +
            '</div>' +
            '</div>'
    }

    //////////////////////////////////////////////////////Datenbankverwaltung/////////////////////////////////////////////////////////

    function optUserTable() {
        userTable();
    }

    function optRoleTable() {
        roleTable();
    }

    function optArticleTable() {
        articleTable();
    }

    function optSessionTable() {
        sessionTable();
    }

    function optNewArticle() {
        newArticle();
    }
</script>
<script>
    var data = {};
    var divResult = document.getElementById('divResult');

    //////////////////////////////////////////////////////Benutzerverwaltung/////////////////////////////////////////////////////////
    function registration() {
        var iptBenutzername = document.getElementById('iptBenutzername');
        var iptPasswort = document.getElementById('iptPasswort');
        data.reg_BN = iptBenutzername.value;
        data.reg_PW = iptPasswort.value;
        console.log(data);
        connection.emit('user.registration', data);
    }

    connection.on('user.registration.result', (data) => {
        console.log(data);
        divResult.innerHTML = "Result: " + data.result;
    });
</script>
</html>